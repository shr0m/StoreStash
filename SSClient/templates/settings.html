<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>

    <link id="theme-style" rel="stylesheet" href="{{ url_for('static', filename='css/' + ('style-dark.css' if current_theme == 'dark' else 'style.css')) }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
</head>
<body>

    <div class="navbar">
        <a href="/"><i class="fa-solid fa-box-open"></i> Stock</a>

        <a href="/people"><i class="fa-solid fa-person"></i> People</a>

        {% if session.get('privilege') == 'admin' %}
            <a href="/admin"><i class="fas fa-user-shield"></i> Admin</a>
        {% endif %}
        <a href="/support"><i class="fa-solid fa-circle-question"></i> Support</a>

        <div class="navsettings">
            <a href="/settings"><i class="fas fa-cog"></i> Settings</a>
            {% if 'user_id' in session %}
                <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            {% endif %}
        </div>
    </div>

    <h1>Settings</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Theme Settings -->
        <section class="settings-category section-highlight">
            <h2><i class="fa-solid fa-paintbrush"></i> Theme</h2>
            <form class="settings-form" method="POST" action="{{ url_for('settings.settings') }}">
                <div class="setting-option switch-container">
                <label for="theme-toggle">Dark Mode</label>
                    <label class="switch">
                        <input 
                            type="checkbox" 
                            id="theme-toggle" 
                            name="theme" 
                            value="dark" 
                            {% if current_theme == 'dark' %}checked{% endif %}
                        >
                        <span class="slider"></span>
                    </label>
                    <span class="setting-description">Toggle between light and dark themes.</span>
                </div>

                <div class="setting-option">
                    <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Update Settings
                    </button>
                </div>
            </form>
        </section>

        <!-- Security Settings -->
        <section class="settings-category section-highlight">
            <h2><i class="fas fa-shield-alt"></i> Security</h2>
            <div class="setting-option">
                <button type="button" class="btn" onclick="location.href='/change_password'">Change Password</button>
            </div>
            <div class="setting-option">
                <button type="button" class="btn" onclick="location.href='/change_email'">Change Email</button>
            </div>
            <div class="setting-option">
                <button 
                    type="button" 
                    class="btn" 
                    style="background-color: red;"
                    onclick="if (confirm('Are you sure you want to perform a hard reset? This action cannot be undone.')) { location.href = '/hard_reset'; }"
                >
                    Hard Reset
                </button>
                </div>
        </section>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const themeLink = document.getElementById('theme-style');

            themeToggle.addEventListener('change', () => {
                const isDarkMode = themeToggle.checked;
                const newHref = isDarkMode
                    ? "{{ url_for('static', filename='css/style-dark.css') }}"
                    : "{{ url_for('static', filename='css/style.css') }}";

                themeLink.setAttribute('href', newHref);
            });
        });
    </script>


</body>
</html>