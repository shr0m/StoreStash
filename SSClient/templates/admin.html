<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Support</title>
</head>
<body>

    <!-- Navigation Bar -->
    <div class="navbar">
        <a href="/">Dashboard</a>
        {% if session.get('privilege') == 'admin' %}
            <a href="/admin">Admin</a>
        {% endif %}

        <a href="/settings">Settings</a>
        <a href="/support">Support</a>

        {% if 'user_id' in session %}
            <a id="logout" href="/logout">Logout</a>
        {% endif %}
    </div>

    <!-- Page Title -->
    <h1>Admin Dashboard</h1>

    

    <div class="form-container">

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <h2>Add Users</h2>
        <form action="/send_otp" method="POST">
            <label>Email:</label>
            <input type="email" name="email" required>
            <label>Privilege:</label>
            <select name="privilege">
                <option value="admin">Admin</option>
                <option value="store team">Store Team</option>
                <option value="view">View</option>
            </select>
            <button type="submit">Add User</button>
        </form>
    </div>

    <!-- Section: Display Users -->
<section class="stock-display">
    <h2>Current Users</h2>
    <table class="stock-table">
        <thead>
            <tr>
                <th>Email</th>
                <th>Privilege</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr data-user-id="{{ user.id }}">
                <!-- Email -->
                <td>{{ user.username }}</td>

                <!-- Privilege -->
                <td>{{ user.privilege }}</td>

                <!-- Action buttons -->
                <td>
                    <form method="POST" action="{{ url_for('reset_password', user_id=user.id) }}" style="display:inline;">
                        <button type="submit">Reset PW</button>
                    </form>
                    <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

</body>
</html>